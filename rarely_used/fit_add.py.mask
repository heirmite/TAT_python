#!/usr/bin/python
'''
Program:
This is a function to add fits element py element.
method:
1. fit_add.py [list name]
editor Jacob975
20170515 
#################################
update log
    20170515 version alpha 1
        It can run properly
    20170604 version alpha 2
        add header file to median.fits, which ignored before.
'''
from sys import argv
import numpy as np
import pyfits
import time
import curvefit
import matplotlib.pyplot as plt
VERBOSE = 0

def readfile(filename):
    fo = open(filename)
    answer_1 = fo.read()
    answer=answer_1.split("\n")
    fo.close()
    return answer

# measure times
start_time = time.time()
# get all names of fits
list_name=argv[-1]
fits_list=readfile(list_name)
del fits_list[-1]
# summantion
sum_fits = []
for name in fits_list:
    data = pyfits.getdata(name)
    if sum_fits == []:
        sum_fits = data
        continue
    sum_fits = np.add(sum_fits, data)
sum_fits = np.divide(sum_fits, len(fits_list))
data_mean, data_std = curvefit.get_mean_std(sum_fits)
# get header file 
imAh = pyfits.getheader(fits_list[0])
# find the property of the new fits
peak_list = curvefit.get_peak(sum_fits)
star_list = curvefit.get_star(sum_fits, data_mean, data_std, peak_list)
# print out results
if VERBOSE>1:
    print "The number of star is ", len(star_list)
    for value in star_list:
        print "height = ", value[0], " position= (", value[1], value[2], "), beamsize = (",value[3], value[4],")"
pyfits.writeto('Median.fits' ,sum_fits ,imAh ,clobber = True)
print "Median.fits OK"
